<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Carles Villar">

<title>La extracci칩n de datos como herramienta fundamental en la elaboraci칩n de estrategias de inversi칩n</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="TAREA_2_CARLES_VILLAR_files/libs/clipboard/clipboard.min.js"></script>
<script src="TAREA_2_CARLES_VILLAR_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="TAREA_2_CARLES_VILLAR_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="TAREA_2_CARLES_VILLAR_files/libs/quarto-html/popper.min.js"></script>
<script src="TAREA_2_CARLES_VILLAR_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="TAREA_2_CARLES_VILLAR_files/libs/quarto-html/anchor.min.js"></script>
<link href="TAREA_2_CARLES_VILLAR_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="TAREA_2_CARLES_VILLAR_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="TAREA_2_CARLES_VILLAR_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="TAREA_2_CARLES_VILLAR_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="TAREA_2_CARLES_VILLAR_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="TAREA_2_CARLES_VILLAR_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="TAREA_2_CARLES_VILLAR_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">



</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">La extracci칩n de datos como herramienta fundamental en la elaboraci칩n de estrategias de inversi칩n</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Carles Villar </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<style>
/* 游꿛 ESTILO GLOBAL (integrado) */
body {
  font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif;
  line-height: 1.7;
  color: #2c3e50;
  background-color: #f8f9fa;
  padding: 25px;
}

/* Encabezados */
h1, h2, h3, h4 {
  color: #1a5276;
  font-weight: 700;
  margin-top: 1.5em;
}
h1 {
  border-bottom: 3px solid #1abc9c;
  padding-bottom: 6px;
}
h2 {
  border-left: 4px solid #3498db;
  padding-left: 10px;
}

/* Enlaces */
a {
  color: #117864;
  text-decoration: none;
}
a:hover {
  text-decoration: underline;
}

/* Tablas */
table {
  border-collapse: collapse;
  width: 100%;
  margin: 20px 0;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}
th, td {
  border: 1px solid #dee2e6;
  padding: 10px;
}
th {
  background-color: #1abc9c;
  color: white;
  text-align: left;
}
tr:nth-child(even) {
  background-color: #f4f6f7;
}

/* C칩digo */
pre, code {
  background-color: #f4f6f7;
  border-radius: 5px;
  padding: 6px;
  font-family: "Courier New", monospace;
}
pre {
  border-left: 4px solid #1abc9c;
  padding: 10px;
  overflow-x: auto;
}

/* Im치genes */
img {
  display: block;
  margin: 25px auto;
  border-radius: 10px;
  box-shadow: 0 3px 12px rgba(0,0,0,0.15);
  max-width: 95%;
}

/* Bloques de salida */
.r-output {
  background-color: #ffffff;
  border-left: 4px solid #1abc9c;
  padding: 10px;
  margin: 10px 0 20px 0;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

/* Pie de p치gina */
footer {
  text-align: center;
  color: #7f8c8d;
  margin-top: 40px;
  font-size: 0.9em;
}
</style>
<p>En este trabajo se aborda c칩mo la extracci칩n de datos puede convertirse en una herramienta fundamental e indispensable para el an치lisis y la toma de decisiones de inversi칩n.</p>
<p>Durante los 칰ltimos meses he comenzado a interesarme por el mundo de la inversi칩n y por las distintas estrategias que permiten proteger el ahorro frente a la inflaci칩n y aumentar el patrimonio de forma inteligente, asumiendo siempre el riesgo inherente de los mercados financieros.</p>
<p>Por ello, he visto en este proyecto una oportunidad para aprender c칩mo el scraping y el an치lisis de datos pueden resultar 칰tiles a la hora de dise침ar estrategias de inversi칩n basadas en informaci칩n real y actualizada, contribuyendo as칤 a una toma de decisiones m치s informada y racional.</p>
<p>En la Parte A del trabajo se ha desarrollado un proceso de <em>web scraping est치tico</em> sobre la secci칩n de mercados del portal <a href="https://finance.yahoo.com/rss/topstories" class="uri">https://finance.yahoo.com/rss/topstories</a>, con el objetivo de recopilar titulares, fechas y enlaces de noticias econ칩micas. Este tipo de informaci칩n permite observar qu칠 temas dominan la actualidad financiera y c칩mo afectan a las variaciones del mercado.</p>
<p>En la Parte B, el enfoque se complementa con un <em>scraping din치mico</em> y automatizado mediante n8n y Firecrawl, centrado en la obtenci칩n de valores burs치tiles en tiempo real. De esta forma, ambas partes del proyecto se integran para mostrar c칩mo la extracci칩n y an치lisis de datos pueden aplicarse de forma pr치ctica al 치mbito de la inversi칩n y la inteligencia de mercado.</p>
<section id="extracci칩n-de-noticias-financieras-mediante-web-scraping-est치tico." class="level2">
<h2 class="anchored" data-anchor-id="extracci칩n-de-noticias-financieras-mediante-web-scraping-est치tico.">Extracci칩n de noticias financieras mediante web scraping est치tico.</h2>
<p>En este apartado del proyecto abordaremos la parte de web scraping est치tico, cuyo objetivo es extraer informaci칩n directamente del contenido HTML de una p치gina web que no dependa de JavaScript para mostrar datos.</p>
<p>Para ello he buscado una p치gina web que ofreciera informaci칩n financiera de inter칠s y que permitiera acceder a ella de forma abierta. Aunque a simple vista podr칤a parecer una tarea sencilla, el proceso result칩 m치s complejo de lo esperado, ya que, tras realizar varias pruebas en diferentes p치ginas web, comprob칠 que algunas, como Yahoo Finance en su versi칩n web, bloquean las solicitudes automatizadas cuando detectan que somos un bot de R, mientras que otras generaban contenido din치mico mediante JavaScript, impidiendo la extracci칩n con m칠todos est치ticos.</p>
<p>Finalmente, he optado por utilizar el feed RRSS de Yahoo Finance, una fuente que ofrece las 칰ltimas noticias financieras en formato XML y de forma abierta, que es justo lo que necesitaba. Al ser un formato est치tico y contener la informaci칩n estructurada en etiquetas, permite la extracci칩n directa sin ning칰n problema.</p>
<p>El siguiente c칩digo muestra el proceso de extracci칩n:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xml2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://finance.yahoo.com/rss/topstories"</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>feed <span class="ot">&lt;-</span> <span class="fu">read_xml</span>(url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>titulos <span class="ot">&lt;-</span> feed <span class="sc">%&gt;%</span> <span class="fu">xml_find_all</span>(<span class="st">"//item/title"</span>) <span class="sc">%&gt;%</span> <span class="fu">xml_text</span>()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>enlaces <span class="ot">&lt;-</span> feed <span class="sc">%&gt;%</span> <span class="fu">xml_find_all</span>(<span class="st">"//item/link"</span>) <span class="sc">%&gt;%</span> <span class="fu">xml_text</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>fechas <span class="ot">&lt;-</span> feed <span class="sc">%&gt;%</span> <span class="fu">xml_find_all</span>(<span class="st">"//item/pubDate"</span>) <span class="sc">%&gt;%</span> <span class="fu">xml_text</span>()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>noticias <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">titulo =</span> titulos,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">enlace =</span> enlaces,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">fecha =</span> fechas,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>noticias <span class="ot">&lt;-</span> noticias <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">titulo =</span> <span class="fu">str_squish</span>(titulo),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">enlace =</span> <span class="fu">str_trim</span>(enlace),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fecha =</span> <span class="fu">str_trim</span>(fecha),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fecha =</span> <span class="fu">ymd_hms</span>(fecha, <span class="at">quiet =</span> <span class="cn">TRUE</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>)  </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(titulo) <span class="sc">&amp;</span> titulo <span class="sc">!=</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small" data-quarto-postprocess="true">
<caption>Primeras noticias extra칤das</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: rgba(26, 188, 156, 255) !important;">titulo</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: rgba(26, 188, 156, 255) !important;">enlace</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: rgba(26, 188, 156, 255) !important;">fecha</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">The 1 Utility Stock You Should Be Buying for the AI Boom</td>
<td style="text-align: left;">https://finance.yahoo.com/news/1-utility-stock-buying-ai-164802144.html</td>
<td style="text-align: left;">2025-11-10 16:48:02</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Earnings live: Instacart stock jumps, Tyson rises with CoreWeave results ahead</td>
<td style="text-align: left;">https://finance.yahoo.com/news/live/earnings-live-instacart-stock-jumps-tyson-rises-with-coreweave-results-ahead-134023513.html</td>
<td style="text-align: left;">2025-11-10 13:40:23</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">How Much a 50-Year Mortgage Saves You Now, Costs You Later</td>
<td style="text-align: left;">https://www.barrons.com/articles/50-year-mortgage-cost-savings-trump-home-buyers-ac115033?siteid=yhoof2&amp;yptr=yahoo</td>
<td style="text-align: left;">2025-11-10 16:36:00</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Health Insurers Are Left Behind as Shutdown Fight Winds Down</td>
<td style="text-align: left;">https://www.barrons.com/articles/health-insurers-stocks-aca-shutdown-0a1985a9?siteid=yhoof2&amp;yptr=yahoo</td>
<td style="text-align: left;">2025-11-10 16:30:00</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Why AnaptysBio Stock Plummeted, Reversing A 70% Monthlong Run</td>
<td style="text-align: left;">https://www.investors.com/news/technology/anaptysbio-stock-ulcerative-colitis-treatment-failure/?src=A00220&amp;yptr=yahoo</td>
<td style="text-align: left;">2025-11-10 16:22:07</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Daily Spotlight: Value Sectors</td>
<td style="text-align: left;">https://finance.yahoo.com/research/reports/ARGUS_45259_MarketOutlook_1762777615000?yptr=yahoo&amp;ncid=yahooproperties_plusresear_nm5q6ze1cei</td>
<td style="text-align: left;">2025-11-10 12:26:55</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Para identificar los selectores que me interesaban, en este caso t칤tulo de la noticia, el enlace para leerla y la fecha de publicaci칩n, me apoy칠 en ChatGPT para que me ayudase a entender como funcionaba la estructura del documento XML de https://finance.yahoo.com/rss/topstories.</p>
<p>Con ello entend칤 que la estructura de la web de la que quer칤a extraer los datos estructuraba los datos en etiquetas jer치rquicas. Cada noticia se encuentra dentro de un nodo 칤tem y este 칤tem contiene diferentes subelementos como son, title, link y pubDate.</p>
<p>Mediante la inspecci칩n directa del c칩digo fuente comprob칠 que estos subelementos se repet칤an en cada noticia, por lo que resultaba m치s sencillo recorrerlos utilizando XPath, accediendo directamente a cada etiqueta dentro del documento para extraer los campos de inter칠s.</p>
<p>Este conjunto de datos nos permite detectar noticias econ칩micas relevantes lo cual nos puede ayudar a detectar movimientos de mercado como a lo largo del trabajo.</p>
</section>
<section id="automatizaci칩n-del-an치lisis-b칰rsatil-mediante-scraping-din치mico-y-n8n." class="level2">
<h2 class="anchored" data-anchor-id="automatizaci칩n-del-an치lisis-b칰rsatil-mediante-scraping-din치mico-y-n8n.">Automatizaci칩n del an치lisis b칰rsatil mediante scraping din치mico y n8n.</h2>
<p>La siguiente parte del trabajo consiste en dies침ar un flujo en n8n utilizando el nodo de firecrawl para realizar scraping din치mico. Para mantener la relaci칩n con el tema anterior y poder proporcionar unos resultados anal칤tico completos vamos a seguir con el tema del mercado de valores.</p>
<p>El objetivo del flujo que he dise침ado es extraer y procesar informaci칩n b칰rsatil de forma automatizada en tiempo real, con el fin de identificar las principales oportunidades de inversi칩n y analizarlas posteriormente con ayuda de inteligencia artificial.</p>
<p>El flujo se componer de diferentes nodos que se explican a continuaci칩n:</p>
<p><img src="images/clipboard-27313073.png" class="img-fluid"></p>
<p>El primer nodo ha sido un triger cuya funci칩n es iniciar el flujo de forma manual, este nodo podr칤a ser sustituido por otro que se active cada 24 horas en caso de que este flijo realmente se quiera usar para encontrar oportunidades de inversi칩n y se quiera estar actualizado.</p>
<p>Los siguientes nodos que he empleado para el dise침o del flujo son tres Edit Fields, en cada uno de los cuales he indicado que enlace correspondiente que se debe utilizar para encontrar los datos a scrapear. En el primero se encuentran los valores de las criptomonedas, en el segundo las acciones ganadoras y, finalmente en el tercero las acciones que m치s han perdido.</p>
<p>A continuaci칩n he utilizado un nodo firecrawl, que es el encargado de realizar el proceso de scraping de las p치ginas web y extraer la informaci칩n necesaria, para ello los par치metros m치s importantes que he configurado han sido el tiempo de espera entre cada intento de acceso a la web, as칤 como el tiempo m치ximo de funcionamiento y el formato de los datos a extraer que despu칠s de varios intentos con formatos como HTML y JSON, los cuales generaban errores durante el procesamiento encontr칠 la soluci칩n utilizando el formato Markdown, el cual me proporcionaba un output legible y estructurado, permitiendo que el siguiente nodo de IA pudiera interpretar la informaci칩n correctamente.</p>
<p>El nodo de Information Extractor lo utilic칠 para procesar la informaci칩n contenida en el archivo Markdown, la cual inclu칤a datos de toda la p치gina web, incluso partes que no eran relevantes para mi an치lisis. Conectando este nodo a Gemini consegu칤 filtrar y obtener 칰nicamente los datos que realmente me interesaban, adem치s de recibirlo en el formato estructurado que necesitaba, es decir, una estructura de datos en JSON donde cada elemento representa un activo financiero, en mi caso una criptomoneda o una acci칩n.</p>
<p>Finalmente, para el almacenamiento en Google Sheets, utilic칠 el nodo split out con el objetivo de dividir el array en varios elementos individuales. De esta manera pude enviar la informaci칩n de forma ordenada, haciendo que cada registro se corresponda con una fila y que cada campo se ubicara correctamente en su columna correspondiente.</p>
<p>En cuanto a la segunda parte del flujo, donde Ia IA busca las mejores oportunidades, el proceso de dise침o fue bastante sencillo.</p>
<p>Inicialmente, utilic칠 un nodo Merge para unir los datos provenientes de las tres hojas de Google Sheets. A continuaci칩n, mediante un nodo functiony con la ayuda de ChatGPT, cree un c칩digo en JavaScript que permiti칩 filtrar y extraer las 10 acciones con mayor variaci칩n, ya fueran acciones que suben, bajan o criptomonedas.</p>
<p>El siguiente pas칩 fue pasarle a la IA de Gemini este output para que realizara un an치lisis y explicara una posible raz칩n por la que estas acciones podr칤an haber variado tanto con el objetivo de encontrar una buena oportunidad de inversi칩n.</p>
<p>Finalmente, la informaci칩n extra칤da por el nodo de IA, fue procesada por otro nodo function el cual, nuevamente con la ayuda de la, desarroll칠 un c칩digo que transforma la informaci칩n en una estructura compatible con Google Sheets, que es donde se almacena finalmente toda la informaci칩n en 4 hojas diferentes.</p>
</section>
<section id="utilidad-anal칤tica" class="level1">
<h1>Utilidad anal칤tica</h1>
<p>En cuanto a la utilidad anal칤tica he creado una funci칩n con el objetivo de relacionar las oportunidades detectadas por Gemini y el sentimiento de las noticias financieras. La idea es aprovechar las dos fuentes de informaci칩n complementarias: por un lado, los datos cuantitativos de variaci칩n de precio y, por otro lado, la informaci칩n cualitativa proveniente de las noticias.</p>
<p>El c칩digo permite tomar las oportunidades de inversi칩n, analizar el sentimiento de los t칤tulos de las noticias y asignar un score a cada activo, combinando la magnitud de la variaci칩n con el contexto informativo del mercado. Esto permite priorizar aquellos activos que muestran una fuerte variaci칩n en el precio y adem치s detectar que noticias refuerzan esta tendencia para identificar posibles oportunidades.</p>
<p>Aunque el c칩digo actual correctamente, considero que tiene bastante margen de mejora, como por ejemplo:</p>
<p>La asignaci칩n de sectores se hace de forma manual, algo que se puede simplificar con m칠todos de clasificaci칩n autom치tica.</p>
<p>La relaci칩n entre noticias y activos se basa en sectores y palabras clave, con un mejor an치lisis ya sea por una mejora en las capacidades computacionales o tiempo se podr칤a realizar un an치lisis m치s fino identificando menciones directas de acciones en titulares, con un abanico m치s amplio tanto de noticias como de acciones.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ---10 oportunidades detectadas con n8n---</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>activos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Nombre =</span> <span class="fu">c</span>(<span class="st">"JFrog Ltd."</span>, <span class="st">"Eos Energy Enterprises, Inc."</span>, <span class="st">"Ubiquiti Inc."</span>, </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">"OneStream, Inc."</span>, <span class="st">"Primo Brands Corporation"</span>, <span class="st">"Expedia Group, Inc."</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Bitcoin"</span>, <span class="st">"Shopify Inc."</span>, <span class="st">"Ethereum"</span>, <span class="st">"Advanced Micro Devices"</span>),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  S칤mbolo <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"FROG"</span>, <span class="st">"EOSE"</span>, <span class="st">"UI"</span>, <span class="st">"OS"</span>, <span class="st">"PRMB"</span>, <span class="st">"EXPE"</span>, <span class="st">"BTC"</span>, <span class="st">"SHOP"</span>, <span class="st">"ETH"</span>, <span class="st">"AMD"</span>),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variacion =</span> <span class="fu">c</span>(<span class="fl">26.96</span>, <span class="fl">19.42</span>, <span class="sc">-</span><span class="fl">19.4</span>, <span class="fl">19.18</span>, <span class="sc">-</span><span class="fl">18.31</span>, <span class="fl">17.55</span>, <span class="sc">-</span><span class="fl">4.8</span>, <span class="sc">-</span><span class="fl">7.2</span>, <span class="sc">-</span><span class="fl">5.2</span>, <span class="sc">-</span><span class="fl">5.5</span>),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sector =</span> <span class="fu">c</span>(<span class="st">"Tech"</span>,<span class="st">"Energy"</span>,<span class="st">"Tech"</span>,<span class="st">"Tech"</span>,<span class="st">"Consumer"</span>,<span class="st">"Travel"</span>,<span class="st">"Crypto"</span>,<span class="st">"Tech"</span>,<span class="st">"Crypto"</span>,<span class="st">"Tech"</span>),</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ---Tokenizar t칤tulos --</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>noticias <span class="ot">&lt;-</span> noticias <span class="sc">%&gt;%</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">titulo_original =</span> titulo)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>noticias_tokens <span class="ot">&lt;-</span> noticias <span class="sc">%&gt;%</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, <span class="at">input =</span> titulo_original, <span class="at">to_lower =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ---Cargar lexicon AFINN ---</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>afinn <span class="ot">&lt;-</span> <span class="fu">get_sentiments</span>(<span class="st">"afinn"</span>)  <span class="co"># descarga autom치tica</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ---Calcular sentiment score por noticia ---</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>noticias_sentiment <span class="ot">&lt;-</span> noticias_tokens <span class="sc">%&gt;%</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(afinn, <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(titulo) <span class="sc">%&gt;%</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sentiment_score =</span> <span class="fu">sum</span>(value), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co"># ---Unir con noticias originales ---</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>noticias <span class="ot">&lt;-</span> noticias <span class="sc">%&gt;%</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(noticias_sentiment, <span class="at">by =</span> <span class="st">"titulo"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sentiment_score =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(sentiment_score), <span class="dv">0</span>, sentiment_score))</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co"># ---Asignar sector a noticias seg칰n palabras clave ---</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>sector_keywords <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tech =</span> <span class="fu">c</span>(<span class="st">"tech"</span>,<span class="st">"AI"</span>,<span class="st">"semiconductor"</span>,<span class="st">"cloud"</span>,<span class="st">"software"</span>,<span class="st">"chip"</span>),</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">Energy =</span> <span class="fu">c</span>(<span class="st">"energy"</span>,<span class="st">"oil"</span>,<span class="st">"gas"</span>,<span class="st">"renewable"</span>,<span class="st">"battery"</span>),</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">Consumer =</span> <span class="fu">c</span>(<span class="st">"consumer"</span>,<span class="st">"retail"</span>,<span class="st">"brand"</span>,<span class="st">"restaurant"</span>,<span class="st">"store"</span>),</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">Travel =</span> <span class="fu">c</span>(<span class="st">"travel"</span>,<span class="st">"hotel"</span>,<span class="st">"airline"</span>,<span class="st">"booking"</span>),</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">Crypto =</span> <span class="fu">c</span>(<span class="st">"bitcoin"</span>,<span class="st">"crypto"</span>,<span class="st">"ethereum"</span>,<span class="st">"blockchain"</span>)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>asignar_sector <span class="ot">&lt;-</span> <span class="cf">function</span>(title){</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(sec <span class="cf">in</span> <span class="fu">names</span>(sector_keywords)){</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">str_detect</span>(title, <span class="fu">regex</span>(<span class="fu">paste</span>(sector_keywords[[sec]], <span class="at">collapse=</span><span class="st">"|"</span>), <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)))){</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(sec)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>noticias<span class="sc">$</span>sector <span class="ot">&lt;-</span> <span class="fu">sapply</span>(noticias<span class="sc">$</span>titulo, asignar_sector)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="co"># ---Sentimiento promedio por sector ---</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>sentimiento_sector <span class="ot">&lt;-</span> noticias <span class="sc">%&gt;%</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(sector)) <span class="sc">%&gt;%</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sector) <span class="sc">%&gt;%</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_sentiment =</span> <span class="fu">mean</span>(sentiment_score),</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_news =</span> <span class="fu">n</span>(),</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a><span class="co"># ---Calcular score final para cada activo ---</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>activos_resumen <span class="ot">&lt;-</span> activos <span class="sc">%&gt;%</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sentimiento_sector, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Sector"</span> <span class="ot">=</span> <span class="st">"sector"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_sentiment =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(mean_sentiment), <span class="dv">0</span>, mean_sentiment),</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_news =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(total_news), <span class="dv">0</span>, total_news),</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Score combina variaci칩n de precio con sentimiento sectorial y n칰mero de noticias</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">score =</span> Variacion <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.1</span> <span class="sc">*</span> mean_sentiment) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.05</span> <span class="sc">*</span> <span class="fu">log1p</span>(total_news))</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(score))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="chfmocmbex" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
#chfmocmbex table {
  font-family: Inter, system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#chfmocmbex thead, #chfmocmbex tbody, #chfmocmbex tfoot, #chfmocmbex tr, #chfmocmbex td, #chfmocmbex th {
  border-style: none;
}

#chfmocmbex p {
  margin: 0;
  padding: 0;
}

#chfmocmbex .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 3px;
  border-top-color: #D3D3D3;
  border-right-style: solid;
  border-right-width: 3px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 3px;
  border-bottom-color: #D3D3D3;
  border-left-style: solid;
  border-left-width: 3px;
  border-left-color: #D3D3D3;
}

#chfmocmbex .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#chfmocmbex .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#chfmocmbex .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#chfmocmbex .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#chfmocmbex .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#chfmocmbex .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#chfmocmbex .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#chfmocmbex .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#chfmocmbex .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#chfmocmbex .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#chfmocmbex .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#chfmocmbex .gt_spanner_row {
  border-bottom-style: hidden;
}

#chfmocmbex .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#chfmocmbex .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#chfmocmbex .gt_from_md > :first-child {
  margin-top: 0;
}

#chfmocmbex .gt_from_md > :last-child {
  margin-bottom: 0;
}

#chfmocmbex .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#chfmocmbex .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 80%;
  font-weight: bolder;
  text-transform: uppercase;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#chfmocmbex .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#chfmocmbex .gt_row_group_first td {
  border-top-width: 2px;
}

#chfmocmbex .gt_row_group_first th {
  border-top-width: 2px;
}

#chfmocmbex .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#chfmocmbex .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#chfmocmbex .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#chfmocmbex .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#chfmocmbex .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#chfmocmbex .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#chfmocmbex .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#chfmocmbex .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#chfmocmbex .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#chfmocmbex .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#chfmocmbex .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#chfmocmbex .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#chfmocmbex .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#chfmocmbex .gt_left {
  text-align: left;
}

#chfmocmbex .gt_center {
  text-align: center;
}

#chfmocmbex .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#chfmocmbex .gt_font_normal {
  font-weight: normal;
}

#chfmocmbex .gt_font_bold {
  font-weight: bold;
}

#chfmocmbex .gt_font_italic {
  font-style: italic;
}

#chfmocmbex .gt_super {
  font-size: 65%;
}

#chfmocmbex .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#chfmocmbex .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#chfmocmbex .gt_indent_1 {
  text-indent: 5px;
}

#chfmocmbex .gt_indent_2 {
  text-indent: 10px;
}

#chfmocmbex .gt_indent_3 {
  text-indent: 15px;
}

#chfmocmbex .gt_indent_4 {
  text-indent: 20px;
}

#chfmocmbex .gt_indent_5 {
  text-indent: 25px;
}

#chfmocmbex .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#chfmocmbex div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}

td {
  font-size: 14px;
  padding: 8px;
}

th {
  font-size: 13px;
  letter-spacing: 0.5px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="7" class="gt_heading gt_title gt_font_normal"><strong>Resumen de activos y su an치lisis combinado</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
</tr>
<tr class="gt_heading even">
<th colspan="7" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Variaci칩n, sentimiento medio y score final</th>
</tr>
<tr class="gt_col_headings header">
<th id="Nombre" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-weight: bold; background-color: #1ABC9C" scope="col">Nombre</th>
<th id="S칤mbolo" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-weight: bold; background-color: #1ABC9C" scope="col">S칤mbolo</th>
<th id="Variaci칩n-(%)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-weight: bold; background-color: #1ABC9C" scope="col">Variaci칩n (%)</th>
<th id="Sector" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-weight: bold; background-color: #1ABC9C" scope="col">Sector</th>
<th id="Sentimiento-medio" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-weight: bold; background-color: #1ABC9C" scope="col">Sentimiento medio</th>
<th id="Noticias" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-weight: bold; background-color: #1ABC9C" scope="col">Noticias</th>
<th id="Score-anal칤tico" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="color: #FFFFFF; font-weight: bold; background-color: #1ABC9C" scope="col">Score anal칤tico</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="Nombre">JFrog Ltd.</td>
<td class="gt_row gt_center" headers="S칤mbolo">FROG</td>
<td class="gt_row gt_center" headers="Variaci칩n (%)"><span style="color:#16a085;font-weight:bold;">+26.96%</span></td>
<td class="gt_row gt_center" headers="Sector">Tech</td>
<td class="gt_row gt_center" headers="Sentimiento medio">0.58</td>
<td class="gt_row gt_center" headers="Noticias">12</td>
<td class="gt_row gt_center" headers="Score anal칤tico">32.19</td>
</tr>
<tr class="even">
<td class="gt_row gt_center gt_striped" headers="Nombre">OneStream, Inc.</td>
<td class="gt_row gt_center gt_striped" headers="S칤mbolo">OS</td>
<td class="gt_row gt_center gt_striped" headers="Variaci칩n (%)"><span style="color:#16a085;font-weight:bold;">+19.18%</span></td>
<td class="gt_row gt_center gt_striped" headers="Sector">Tech</td>
<td class="gt_row gt_center gt_striped" headers="Sentimiento medio">0.58</td>
<td class="gt_row gt_center gt_striped" headers="Noticias">12</td>
<td class="gt_row gt_center gt_striped" headers="Score anal칤tico">22.90</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="Nombre">Eos Energy Enterprises, Inc.</td>
<td class="gt_row gt_center" headers="S칤mbolo">EOSE</td>
<td class="gt_row gt_center" headers="Variaci칩n (%)"><span style="color:#16a085;font-weight:bold;">+19.42%</span></td>
<td class="gt_row gt_center" headers="Sector">Energy</td>
<td class="gt_row gt_center" headers="Sentimiento medio">0.00</td>
<td class="gt_row gt_center" headers="Noticias">1</td>
<td class="gt_row gt_center" headers="Score anal칤tico">20.09</td>
</tr>
<tr class="even">
<td class="gt_row gt_center gt_striped" headers="Nombre">Expedia Group, Inc.</td>
<td class="gt_row gt_center gt_striped" headers="S칤mbolo">EXPE</td>
<td class="gt_row gt_center gt_striped" headers="Variaci칩n (%)"><span style="color:#16a085;font-weight:bold;">+17.55%</span></td>
<td class="gt_row gt_center gt_striped" headers="Sector">Travel</td>
<td class="gt_row gt_center gt_striped" headers="Sentimiento medio">0.00</td>
<td class="gt_row gt_center gt_striped" headers="Noticias">0</td>
<td class="gt_row gt_center gt_striped" headers="Score anal칤tico">17.55</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="Nombre">Bitcoin</td>
<td class="gt_row gt_center" headers="S칤mbolo">BTC</td>
<td class="gt_row gt_center" headers="Variaci칩n (%)"><span style="color:#e74c3c;font-weight:bold;">-4.8%</span></td>
<td class="gt_row gt_center" headers="Sector">Crypto</td>
<td class="gt_row gt_center" headers="Sentimiento medio">1.00</td>
<td class="gt_row gt_center" headers="Noticias">2</td>
<td class="gt_row gt_center" headers="Score anal칤tico">5.57</td>
</tr>
<tr class="even">
<td class="gt_row gt_center gt_striped" headers="Nombre">Ethereum</td>
<td class="gt_row gt_center gt_striped" headers="S칤mbolo">ETH</td>
<td class="gt_row gt_center gt_striped" headers="Variaci칩n (%)"><span style="color:#e74c3c;font-weight:bold;">-5.2%</span></td>
<td class="gt_row gt_center gt_striped" headers="Sector">Crypto</td>
<td class="gt_row gt_center gt_striped" headers="Sentimiento medio">1.00</td>
<td class="gt_row gt_center gt_striped" headers="Noticias">2</td>
<td class="gt_row gt_center gt_striped" headers="Score anal칤tico">6.03</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="Nombre">Advanced Micro Devices</td>
<td class="gt_row gt_center" headers="S칤mbolo">AMD</td>
<td class="gt_row gt_center" headers="Variaci칩n (%)"><span style="color:#e74c3c;font-weight:bold;">-5.5%</span></td>
<td class="gt_row gt_center" headers="Sector">Tech</td>
<td class="gt_row gt_center" headers="Sentimiento medio">0.58</td>
<td class="gt_row gt_center" headers="Noticias">12</td>
<td class="gt_row gt_center" headers="Score anal칤tico">6.57</td>
</tr>
<tr class="even">
<td class="gt_row gt_center gt_striped" headers="Nombre">Shopify Inc.</td>
<td class="gt_row gt_center gt_striped" headers="S칤mbolo">SHOP</td>
<td class="gt_row gt_center gt_striped" headers="Variaci칩n (%)"><span style="color:#e74c3c;font-weight:bold;">-7.2%</span></td>
<td class="gt_row gt_center gt_striped" headers="Sector">Tech</td>
<td class="gt_row gt_center gt_striped" headers="Sentimiento medio">0.58</td>
<td class="gt_row gt_center gt_striped" headers="Noticias">12</td>
<td class="gt_row gt_center gt_striped" headers="Score anal칤tico">8.60</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="Nombre">Primo Brands Corporation</td>
<td class="gt_row gt_center" headers="S칤mbolo">PRMB</td>
<td class="gt_row gt_center" headers="Variaci칩n (%)"><span style="color:#e74c3c;font-weight:bold;">-18.31%</span></td>
<td class="gt_row gt_center" headers="Sector">Consumer</td>
<td class="gt_row gt_center" headers="Sentimiento medio">0.00</td>
<td class="gt_row gt_center" headers="Noticias">0</td>
<td class="gt_row gt_center" headers="Score anal칤tico">18.31</td>
</tr>
<tr class="even">
<td class="gt_row gt_center gt_striped" headers="Nombre">Ubiquiti Inc.</td>
<td class="gt_row gt_center gt_striped" headers="S칤mbolo">UI</td>
<td class="gt_row gt_center gt_striped" headers="Variaci칩n (%)"><span style="color:#e74c3c;font-weight:bold;">-19.4%</span></td>
<td class="gt_row gt_center gt_striped" headers="Sector">Tech</td>
<td class="gt_row gt_center gt_striped" headers="Sentimiento medio">0.58</td>
<td class="gt_row gt_center gt_striped" headers="Noticias">12</td>
<td class="gt_row gt_center gt_striped" headers="Score anal칤tico">23.16</td>
</tr>
</tbody><tfoot>
<tr class="gt_footnotes odd">
<td colspan="7" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> El 'Score anal칤tico' combina la variaci칩n, el sentimiento del sector y el n칰mero de noticias.</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<p>Finalmente, el c칩digo genera una tabla donde se pueden ver los activos por sector, el sentimiento medio de las noticias y un score que combina variaci칩n de precio, sentimiento y n칰mero de noticias.</p>
<p>Esto permite identificar r치pidamente qu칠 activos muestran un fuerte movimiento respaldado por noticias y cu치les podr칤an estar movi칠ndose de forma especulativa.</p>
<p><strong>mean_sentiment</strong>: indica si las noticias del sector son mayormente positivas o negativas. Valores &gt; 0 noticias positivas, valores &lt; 0 negativas y =0 neutrales.</p>
<p><strong>total_news</strong>: muestra cu치ntas noticias se han analizado por sector.</p>
<p><strong>score</strong>: combina la variaci칩n de precio con el sentimiento y la cantidad de noticias; cuanto mayor sea, m치s coherente est치 el movimiento con el contexto informativo. Un score alto significa que la acci칩n se est치 moviendo en la direcci칩n respaldada por noticias positivas del sector, mientras que un score bajo puede se침alas movimientos sin fundamento.</p>
<p>Dos ejemplos pr치cticos de como se podr칤an interpretar los resultados (con valors hipot칠ticos):</p>
<p>Si JFrog Ltd tiene mean_sentiment = 0.8 y una variaci칩n positiva del 26.96%, indica que no solo subi칩 mucho, sino que adem치s hay varias noticias positivas que refuerzan este movimiento.</p>
<p>Si Shopify tiene mean_sentiment = 1, pero la acci칩n cae un 7.2%, hay una divergencia: las noticias son algo positivas, pero el precio baja, lo que puede indicar oportunidad de compra ya que hay noticias positivas pero la acci칩n por alg칰n motivo est치 bajando.</p>
</section>
<section id="conclusi칩n" class="level1">
<h1>Conclusi칩n</h1>
<p>En conclusi칩n, este trabajo me ha permitido combinar an치lisis de precios con el sentimiento de noticias para generar un indicador que ayuda a priorizar oportunidades de inversi칩n de forma m치s fundamentada. El proceso ha sido muy motivador, ya que me ha permitido ver c칩mo los datos y la informaci칩n de mercado pueden integrarse para obtener ejemplos pr치cticos. Al mismo tiempo, es evidente que existe un gran margen de mejora: desde automatizar la asignaci칩n de sectores, ampliar el an치lisis de noticias, hasta identificar menciones directas de cada activo en los titulares y aumentar la lista de oportunidades, lo que permitir칤a un an치lisis m치s preciso y robusto. Este proyecto sienta las bases para seguir perfeccionando herramientas de an치lisis que integren datos cuantitativos y cualitativos de forma eficiente.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "燁";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>